<!DOCTYPE html>
<html lang="en">

<head>
  <style>
    body {
      margin: 0;
      overflow: hidden;

    }

    #3d-graph {
      width: 100%;
      height: 100vh;
    }

    .modal {
      height: 650px;
      width: 1200px;
      padding: 20px;
      border-radius: 10px;
      backdrop-filter: blur(10px);
      /* Added blur effect to the background */
      box-shadow: 0 0 10px rgba(225, 225, 225, 0.5);
      z-index: 1;
      border: 0.5px solid #ffffff;
      color: white;
      display: flex;
      flex-direction: column;
      overflow: auto;
    }

    .modal h2 {
      font-weight: bold;
    }

    #closeNaafaModal,
    #closeFailerModal,
    #closeNolgaModal,
    #closeTtackModal,
    #closePayModal {
      position: absolute;
      top: 10px;
      right: 10px;
      /* Updated to move the close button to the right */
      font-size: 20px;
      cursor: pointer;
      background-color: #d9d9d950;
      border-radius: 50%;
      width: 30px;
      /* Set width and height to create a circular shape */
      height: 30px;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0;
      color: #fff;
      /* Set the color of the 'x' */
      border: none;
      outline: none;
      text-align: center;
    }

    .image-container {
      display: flex;
      justify-content: flex-end;
      /* Align images to the right */
    }

    .image-container img {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 38%;
    }

    .custom-button {
      padding: 6px 10px;
      margin: 10px;
      border: 1px solid #ffffff;
      background-color: #d9d9d959;
      border-radius: 50px;
      color: #ffffff;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .image-container img {
        width: 65%;
        /* Hide the images on smaller screens */
      }

      .modal {
        width: 100%;
        /* Adjusting modal width to full width on smaller screens */
      }

      .custom-button {
        width: 100%;
        box-sizing: border-box;
        margin: 10px auto;
        /* Center the button horizontally */
      }
    }
  </style>
  <script src="//unpkg.com/three"></script>
  <script src="//unpkg.com/3d-force-graph"></script>
</head>

<body>
  <div id="NaafaModalBackground" style="
        height: 100vh;
        width: 100vw;
        position: fixed;
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
      ">
    <div id="naafaModal" class="modal">
      <span id="closeNaafaModal">&times;</span>
      <div style="flex: 1">
        <div>
          <img src="p.png" alt="Your Image" style="margin-right: 10px" />
          <img src="h.png" alt="Your Image" />
          <p style="
                float: right;
                color: rgba(255, 255, 255, 0.822);
                margin-right: 10px;
              ">
            Platfrom 01
          </p>
        </div>

        <h1>나아파 Naafaa</h1>
        <p>나아파는 가나다라마바사아자차카타파하</p>
      </div>
      <div class="image-container">
        <div>
          <img src="Naafaa2.svg" alt="Naafa Image" />
        </div>
      </div>
      <div style="width: 35%">
        <button class="custom-button" onclick="showNaafaModal()">
          의료통합 Saas 플랫폼
        </button>
        <button class="custom-button" onclick="showNaafaModal()">
          디지털 헬스케어
        </button>
        <button class="custom-button" onclick="showNaafaModal()">
          의료 혁신
        </button>
        <button class="custom-button" onclick="showNaafaModal()">
          CRM+EMR+APP+HR
        </button>
      </div>
    </div>
  </div>

  <div id="FailerModalBackground" style="
        height: 100vh;
        width: 100vw;
        position: fixed;
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
      ">
    <div id="failerModal" class="modal">
      <span id="closeFailerModal">&times;</span>
      <div style="flex: 1">
        <div>
          <img src="p.png" alt="Your Image" style="margin-right: 10px" />
          <img src="F.png" alt="Your Image" />
          <p style="
                float: right;
                color: rgba(255, 255, 255, 0.822);
                margin-right: 10px;
              ">
            Platfrom 02
          </p>
        </div>

        <h1>페일러톡 FailerTalk</h1>
        <p>페일러톡은 가나다라마바사아자차카타파하</p>
      </div>
      <div class="image-container">
        <div>
          <img src="Failer2.svg" alt="Naafa Image" />
        </div>
      </div>
      <div style="width: 35%">
        <button class="custom-button" onclick="showFailerModal()">
          나의 실수·실패 공유
        </button>
        <button class="custom-button" onclick="showFailerModal()">
          소통 커뮤니티
        </button>
        <button class="custom-button" onclick="showFailerModal()">
          어쩌고 저쩌고
        </button>
        <button class="custom-button" onclick="showFailerModal()">
          어쩌고 저쩌고
        </button>
      </div>
    </div>
  </div>

  <div id="NolgaModalBackground" style="
        height: 100vh;
        width: 100vw;
        position: fixed;
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
      ">
    <div id="NolgaModal" class="modal">
      <span id="closeNolgaModal">&times;</span>
      <div style="flex: 1">
        <div>
          <img src="p.png" alt="Your Image" style="margin-right: 10px" />
          <img src="N.png" alt="Your Image" />
          <p style="
                float: right;
                color: rgba(255, 255, 255, 0.822);
                margin-right: 10px;
              ">
            Platfrom 03
          </p>
        </div>

        <h1>놀가 Nolga</h1>
        <p>놀가는 가나다라마바사아자차카타파하</p>
      </div>
      <div class="image-container">
        <div>
          <img src="Nolga2.svg" alt="Naafa Image" />
        </div>
      </div>
      <div style="width: 35%">
        <button class="custom-button" onclick="showNolgaModal()">
          농어촌 빈집 장기 임대플랫폼
        </button>
        <button class="custom-button" onclick="showNolgaModal()">
          전자 계약
        </button>
        <button class="custom-button" onclick="showNolgaModal()">
          스마트팜
        </button>
        <button class="custom-button" onclick="showNolgaModal()">
          리모델링
        </button>
      </div>
    </div>
  </div>

  <div id="TtackModalBackground" style="
        height: 100vh;
        width: 100vw;
        position: fixed;
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
      ">
    <div id="ttackModal" class="modal">
      <span id="closeTtackModal">&times;</span>
      <div style="flex: 1">
        <div>
          <img src="p.png" alt="Your Image" style="margin-right: 10px" />
          <img src="T.png" alt="Your Image" />
          <p style="
                float: right;
                color: rgba(255, 255, 255, 0.822);
                margin-right: 10px;
              ">
            Platfrom 04
          </p>
        </div>

        <h1>딱따구리 TtackTaguri</h1>
        <p>딱따구리는 가나다라마바사아자차카타파하</p>
      </div>
      <div class="image-container">
        <div>
          <img src="Ttackttaguri2.svg" alt="TtackTaguri Image" />
        </div>
      </div>
      <div style="width: 35%">
        <button class="custom-button" onclick="showTtackModal()">
          딱따구리 기능 1
        </button>
        <button class="custom-button" onclick="showTtackModal()">
          딱따구리 기능 2
        </button>
        <button class="custom-button" onclick="showTtackModal()">
          딱따구리 기능 3
        </button>
        <button class="custom-button" onclick="showTtackModal()">
          딱따구리 기능 4
        </button>
      </div>
    </div>
  </div>

  <div id="PayModalBackground" style="
        height: 100vh;
        width: 100vw;
        position: fixed;
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
      ">
    <div id="payModal" class="modal">
      <span id="closePayModal">&times;</span>
      <div style="flex: 1">
        <div>
          <img src="p.png" alt="Your Image" style="margin-right: 10px" />
          <img src="m.png" alt="Your Image" />
          <p style="
                float: right;
                color: rgba(255, 255, 255, 0.822);
                margin-right: 10px;
              ">
            Platfrom 04
          </p>
        </div>

        <h1>문자페이 Moonjapay</h1>
        <p>문자페이는 가나다라마바사아자차카타파하</p>
      </div>
      <div class="image-container">
        <div>
          <img src="Moonjapay2.svg" alt="Moonjapay Image" width="55%" />
        </div>
      </div>
      <div style="width: 35%">
        <button class="custom-button" onclick="showPayModal()">
          문자페이 기능 1
        </button>
        <button class="custom-button" onclick="showPayModal()">
          문자페이 기능 2
        </button>
        <button class="custom-button" onclick="showPayModal()">
          문자페이 기능 3
        </button>
        <button class="custom-button" onclick="showPayModal()">
          문자페이 기능 4
        </button>
      </div>
    </div>
  </div>

  <div id="3d-graph"></div>

  <script>
    const distance = 245;

    const nodeImages = {
      1: "logo.svg",
      2: {
        플랫폼: "Platform.svg",
        기술: "SI.svg",
        SNS: "SNS.svg",
        수상: "Win.svg",
      },
      3: {
        페일러톡: "Failertalk.svg",
        딱따구리: "Ttakttaguri.svg",
        나아파: "Naafaa.svg",
        문자페이: "Moonjapay.svg",
        놀가: "Nolga.svg",
        "서버 솔루션": "Server.svg",
        "보안 솔루션": "Security.svg",
        "네트워크 솔루션": "Network.svg",
        "Computer HW": "Hardware.svg",
        보이스인프라: "Voiceinfra.svg",
        "Computer SW": "Software.svg",
        인스타그램: "Insta.svg",
        홈페이지: "Homepage.svg",
        "네이버 블로그": "Blog.svg",
        카카오톡: "Kakao.svg",
        "중소벤처기업부 경영혁신 부문 장관상": "Win.svg",
        "대한민국 엔지니어상": "Win.svg",
        "한국 대표 브랜드 TOP 100 [IT 플랫폼] 부문 수상": "Win.svg",
      },
    };

    const Graph = ForceGraph3D()(document.getElementById("3d-graph"))
      .jsonUrl("../datasets/miserables.json")
      .nodeLabel("id")
      .nodeAutoColorBy("group")
      .enableNavigationControls(false)
      .enableNodeDrag(false)
      .onNodeClick((node) => {
        const nodeId = node.id;
        if (nodeImages[node.group]) {
          const imageSrc = nodeImages[node.group];
          if (typeof imageSrc === "object" && imageSrc[nodeId]) {
            // You can add any action you want when a node is clicked
            console.log(`Node "${nodeId}" clicked!`);
          }
        }
      })

      .nodeThreeObject((node) => {
        const groupId = node.group;
        const nodeId = node.id;

        if (nodeImages[groupId]) {
          let imageSrc = nodeImages[groupId];

          if (typeof imageSrc === "object" && imageSrc[nodeId]) {
            imageSrc = imageSrc[nodeId];
          }

          const textureLoader = new THREE.TextureLoader();

          const svgTexture = textureLoader.load(imageSrc);
          svgTexture.encoding = THREE.sRGBEncoding;
          const svgMaterial = new THREE.MeshBasicMaterial({
            map: svgTexture,
            depthTest: false,
            transparent: true,
            side: THREE.DoubleSide,
          });

          // 3D 메시 생성
          const svgMesh = new THREE.Mesh(new THREE.PlaneGeometry(15, 15), svgMaterial); // 노드 크기를 조절




          const logoTexture = textureLoader.load(imageSrc);
          logoTexture.encoding = THREE.sRGBEncoding;

          logoTexture.wrapS = THREE.ClampToEdgeWrapping;
          logoTexture.wrapT = THREE.ClampToEdgeWrapping;

          const logoMaterial = new THREE.MeshBasicMaterial({
            map: logoTexture,
            depthTest: false,
            transparent: true,
            side: THREE.DoubleSide,
          });

          const logo = new THREE.Mesh(new THREE.PlaneGeometry(5, 5), logoMaterial);


          const imageMaterial = new THREE.MeshBasicMaterial({
            map: logoTexture,
            depthTest: false,
            transparent: true,
            // alphaTest : 0.3,
            opacity: 1,
            side: THREE.DoubleSide,
          });

          const image = new THREE.Mesh(
            new THREE.PlaneGeometry(17, 17),
            imageMaterial
          );

          image.onBeforeRender = function (
            renderer,
            scene,
            camera,
            geometry,
            material,
            group
          ) {
            const euler = new THREE.Euler();
            euler.copy(camera.rotation);
            image.rotation.set(euler.x, euler.y, euler.z);
          };

          const group = new THREE.Group();
          group.add(image);

          // if (nodeId === "수상") {
          //   group.position.set(-50, 0, 0); // 수정: 원하는 좌표로 변경
          // } else {
          //   group.position.set(50, 78, 0); // Default position
          // }


          return group;
        }
      })
      .onEngineTick(() => {
        Graph.graphData().nodes.forEach((n) => {
          if (n.id === "로봇앤컴") {
            n.__threeObj.scale.set(4, 4, 4);
          } else if (["플랫폼", "기술", "수상", "SNS"].includes(n.id)) {
            n.__threeObj.scale.set(2, 2, 2);
          }
        });
      });

    window.addEventListener("resize", () => {
      const graphContainer = document.getElementById("3d-graph");
      Graph.width(graphContainer.offsetWidth).height(
        graphContainer.offsetHeight
      );
    });

    // Function to zoom in to a node
    function zoomInToNode(node) {
      const distance = 40;
      const distRatio = 1 + distance / Math.hypot(node.x, node.y, node.z);

      Graph.cameraPosition(
        {
          x: node.x * distRatio,
          y: node.y * distRatio,
          z: node.z * distRatio,
        },
        node,
        3000
      );
    }



    Graph.onNodeClick((node) => {
      console.log("Node clicked:", node);

      const nodeId = node.id;
      const nodeGroup = node.group;

      console.log(`Clicked Node: ${nodeId}, Group: ${nodeGroup}`);

      if (nodeImages[nodeGroup]) {
        const imageSrc = nodeImages[nodeGroup];
        if (typeof imageSrc === "object" && imageSrc[nodeId]) {
          console.log(`Node "${nodeId}" clicked!`);

          switch (nodeId) {
            case "나아파":
              console.log("Calling showNaafaModal");
              showNaafaModal();
              break;
            case "페일러톡":
              console.log("Calling showFailerModal");
              showFailerModal();
              break;
            case "놀가":
              console.log("Calling showNolgaModal");
              showNolgaModal();
              break;
            case "딱따구리":
              console.log("Calling showTtackModal");
              showTtackModal();
              break;
            case "문자페이":
              console.log("Calling showPayModal");
              showPayModal();
              break;
            default:
              break;
          }

          return;
        }
      }

      if (nodeGroup === 3) {
        switch (nodeId) {
          case "인스타그램":
          case "홈페이지":
          case "네이버 블로그":
          case "카카오톡":
            console.log(`Opening link for ${nodeId}`);
            window.open(getLinkForNode(nodeId), "_blank");
            break;
          default:
            break;
        }
      }
    });


    // camera orbit
    let angle = 10;
    setInterval(() => {
      Graph.cameraPosition({
        x: distance * Math.sin(angle),
        z: distance * Math.cos(angle),
      });
      angle += Math.PI / 6500;
    }, 10);

    const textureLoader = new THREE.TextureLoader();
    const backgroundTexture = textureLoader.load(
      "https://cdn.pixabay.com/photo/2016/09/08/12/00/stars-1654074_1280.jpg"
    );

    Graph.renderer().setClearColor(new THREE.Color("rgba(0, 0, 0, 1)")); // Set alpha value (0.8 for 80% opacity)
    backgroundTexture.minFilter = THREE.NearestFilter;
    Graph.scene().background = backgroundTexture;

    function showNaafaModal() {
      const modal = document.getElementById("NaafaModalBackground");
      modal.style.display = "flex";
      window.addEventListener("click", hideNaafaModal);
    }

    // Function to hide Naafa modal
    function hideNaafaModal(event) {
      event.stopPropagation();
      const modal = document.getElementById("NaafaModalBackground");
      modal.style.display = "none";
    }

    document.getElementById("closeNaafaModal").addEventListener("click", hideNaafaModal);

    // Function to show Failer modal
    function showFailerModal() {
      const modal = document.getElementById("FailerModalBackground");
      modal.style.display = "flex";
      window.addEventListener("click", hideFailerModal);
    }

    // Function to hide Failer modal
    function hideFailerModal(event) {
      event.stopPropagation();
      const modal = document.getElementById("FailerModalBackground");
      modal.style.display = "none";
    }

    document.getElementById("closeFailerModal").addEventListener("click", hideFailerModal);

    // Function to show Nolga modal
    function showNolgaModal() {
      console.log("showNolgaModal function called");
      const modal = document.getElementById("NolgaModalBackground");
      if (!modal) {
        console.error("NolgaModalBackground not found!");
        return;
      }

      modal.style.display = "flex";
      window.addEventListener("click", hideNolgaModal);
    }

    // Function to hide Nolga modal
    function hideNolgaModal(event) {
      event.stopPropagation();
      console.log("Hide Nolga Modal");
      const modal = document.getElementById("NolgaModalBackground");
      if (!modal) {
        console.error("NolgaModalBackground not found!");
        return;
      }

      modal.style.display = "none";
    }

    document.getElementById("closeNolgaModal").addEventListener("click", hideNolgaModal);

    function showTtackModal() {
      const modal = document.getElementById("TtackModalBackground");
      modal.style.display = "flex";
      window.addEventListener("click", hideTtackModal);
    }

    // Function to hide Ttack modal
    function hideTtackModal(event) {
      event.stopPropagation();
      const modal = document.getElementById("TtackModalBackground");
      modal.style.display = "none";
    }

    document.getElementById("closeTtackModal").addEventListener("click", hideTtackModal);

    // Function to show Pay modal
    function showPayModal() {
      const modal = document.getElementById("PayModalBackground");
      modal.style.display = "flex";
      window.addEventListener("click", hidePayModal);
    }

    // Function to hide Pay modal
    function hidePayModal(event) {
      event.stopPropagation();
      const modal = document.getElementById("PayModalBackground");
      modal.style.display = "none";
    }

    document.getElementById("closePayModal").addEventListener("click", hidePayModal);




    window.showNaafaModal = showNaafaModal;
    window.showFailerModal = showFailerModal;
    window.showNolgaModal = showNolgaModal;
    window.showTtackModal = showTtackModal;
    window.showPayModal = showPayModal;

    function getLinkForNode(nodeId) {
      const linkMap = {
        "인스타그램": "https://www.instagram.com/robot_n_com/",
        "홈페이지": "https://www.robotncom.com/",
        "네이버 블로그": "https://blog.naver.com/robotncom",
        "카카오톡": "http://pf.kakao.com/_VMxcds",
      };
      return linkMap[nodeId] || "#";
    }
  </script>
</body>

</html>