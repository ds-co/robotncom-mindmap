<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }

      #3d-graph {
        width: 100%;
        height: 100vh;
      }

      /* Style for the modal */
      .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0); /* Transparent background */
      }

      /* Style for the modal content */
      .modal-content {
        position: absolute;
        top: 50%;
        right: 20px;
        transform: translate(0, -50%);
        background-color: #fefefe;
        padding: 20px;
        border: 1px solid #888;
        width: 40%; /* Adjust the width as needed */
        max-width: 800px;
        height: 90%;
        text-align: center;
      }

      /* Style for the close button */
      .close {
        position: absolute;
        top: 0;
        right: 0;
        padding: 10px;
        cursor: pointer;
      }

      /* Style for the modal image */
      .modal-content img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
      }
    </style>
    <script src="//unpkg.com/three"></script>
    <script src="//unpkg.com/3d-force-graph"></script>
  </head>

  <body>
    <div id="3d-graph"></div>

    <!-- Modal -->
    <div id="myModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div id="modal-content"></div>
      </div>
    </div>

    <script>
      const distance = 350;

      const nodeImages = {
        1: "logo.png",
        2: {
          플랫폼: "Platform.png",
          기술: "SI.png",
          SNS: "SNS.png",
          수상: "Win.png",
        },
        3: {
          페일러톡: "Platform.png",
          딱따구리: "Ttakttaguri.png",
          나아파: "Naafaa.png",
          문자페이: "Moonjapay.png",
          놀가: "Nolga.png",
          "서버 솔루션": "Server.png",
          "보안 솔루션": "Security.png",
          "네트워크 솔루션": "Network.png",
          "Computer HW": "Hardware.png",
          보이스인프라: "Voiceinfra.png",
          "Computer SW": "Software.png",
          인스타그램: "Insta.png",
          홈페이지: "Home.png",
          "네이버 블로그": "Blog.png",
          카카오톡: "Kakao.png",
          "중소벤처기업부 경영혁신 부문 장관상": "Win.png",
          "대한민국 엔지니어상": "Win.png",
          "한국 대표 브랜드 TOP 100 [IT 플랫폼] 부문 수상": "Win.png",
        },
      };

      const Graph = ForceGraph3D()(document.getElementById("3d-graph"))
        .jsonUrl("../datasets/miserables.json")
        .nodeLabel("id")
        .nodeAutoColorBy("group")
        .enableNavigationControls(false)
        .enableNodeDrag(false)
        .onNodeClick((node) => {
          const nodeId = node.id;
          if (nodeImages[node.group]) {
            const imageSrc = nodeImages[node.group];
            if (typeof imageSrc === "object" && imageSrc[nodeId]) {
              openModal(nodeId, imageSrc[nodeId]);
            }
          }
        })

        .nodeThreeObject((node) => {
          const groupId = node.group;
          const nodeId = node.id;

          if (nodeImages[groupId]) {
            let imageSrc = nodeImages[groupId];

            if (typeof imageSrc === "object" && imageSrc[nodeId]) {
              imageSrc = imageSrc[nodeId];
            }

            const textureLoader = new THREE.TextureLoader();
            const logoTexture = textureLoader.load(imageSrc);
            const imageMaterial = new THREE.MeshBasicMaterial({
              map: logoTexture,
              depthTest: false,
              transparent: true,
              opacity: 1,
              side: THREE.DoubleSide,
            });
            const image = new THREE.Mesh(
              new THREE.PlaneGeometry(20, 20),
              imageMaterial
            );

            image.onBeforeRender = function (
              renderer,
              scene,
              camera,
              geometry,
              material,
              group
            ) {
              const euler = new THREE.Euler();
              euler.copy(camera.rotation);
              image.rotation.set(euler.x, euler.y, euler.z);
            };

            const group = new THREE.Group();
            group.add(image);

            return group;
          }
        })
        .onEngineTick(() => {
          Graph.graphData().nodes.forEach((n) => {
            if (n.id === "로봇앤컴") {
              n.__threeObj.scale.set(4, 4, 4);
            } else if (["플랫폼", "기술", "수상", "SNS"].includes(n.id)) {
              n.__threeObj.scale.set(2, 2, 2);
            }
          });
        });

      const modal = document.getElementById("myModal");
      const span = document.getElementsByClassName("close")[0];

      function openModal(content, imageUrl, linkUrl) {
        modal.style.display = "block";
        document.getElementById("modal-content").innerHTML = content;

        if (imageUrl) {
          const img = document.createElement("img");
          img.src = imageUrl;
          if (linkUrl) {
            const link = document.createElement("a");
            link.href = linkUrl;
            link.target = "_blank";
            link.appendChild(img);
            document.getElementById("modal-content").appendChild(link);
          } else {
            document.getElementById("modal-content").appendChild(img);
          }
        }
      }

      span.onclick = function () {
        modal.style.display = "none";
      };

      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };

      window.addEventListener("resize", () => {
        Graph.width(elem.offsetWidth).height(elem.offsetHeight);
      });

      const nodeData = {
        페일러톡: {
          content: "페일러톡 : 나의 실수·실패 카테고리로 나를 표현하자",
          image: "https://failertalk.com/images/thumbnail.png",
          link: "https://failertalk.com/",
        },
        딱따구리: {
          content: "딱따구리 : 모든 수리·수선은 딱따구리!",
          image: "https://taktaguri.com/src/assets/thumbnail.png",
          link: "https://taktaguri.com/",
        },
        나아파: {
          content:
            "나아파 : 환자,의사, 병원 모두를 위한 비대면 진료 통합 CRM+ 플랫폼",
          image: "https://naafaa.co.kr/src/assets/thumbnail.png",
          link: "https://naafaa.co.kr/",
        },
        문자페이: {
          content: "문자페이 : 간편 문자 결제 서비스",
          image:
            "https://cdn.itbiznews.com/news/photo/202310/115814_112150_4722.png",
          link: "https://moonjapay.co.kr/",
        },
        놀가: {
          content: "놀가 : 농어촌 빈집 장기 임대플랫폼",
          image:
            "https://cdn.itbiznews.com/news/photo/202310/115814_112150_4722.png",
          link: "https://moonjapay.co.kr/",
        },

        "한국 대표 브랜드 TOP 100 [IT 플랫폼] 부문 수상": {
          content: "한국 대표 브랜드 TOP 100 [IT 플랫폼] 부문 수상",
          image:
            "https://cdn.imweb.me/upload/S2022080431e5bcc0e2eaf/594205560d31f.jpg",
        },
        "대한민국 엔지니어상": {
          content: "대한민국 엔지니어상",
          image: "./a2.png",
        },
        "중소벤처기업부 경영혁신 부문 장관상": {
          content: "중소벤처기업부 경영혁신 부문 장관상",
          image: "./a1.png",
        },
      };

      // Function to zoom in to a node
      function zoomInToNode(node) {
        const distance = 40;
        const distRatio = 1 + distance / Math.hypot(node.x, node.y, node.z);

        Graph.cameraPosition(
          {
            x: node.x * distRatio,
            y: node.y * distRatio,
            z: node.z * distRatio,
          },
          node,
          3000
        );
      }

      Graph.onNodeClick((node) => {
        const nodeId = node.id;
        if (nodeData[nodeId]) {
          openModal(
            nodeData[nodeId].content,
            nodeData[nodeId].image,
            nodeData[nodeId].link
          );
          zoomInToNode(node); // Call zoomInToNode when a node is clicked
        }
      });

      // camera orbit
      let angle = 10;
      setInterval(() => {
        Graph.cameraPosition({
          x: distance * Math.sin(angle),
          z: distance * Math.cos(angle),
        });
        angle += Math.PI / 6500;
      }, 10);

      const textureLoader = new THREE.TextureLoader();
      const backgroundTexture = textureLoader.load(
        "https://images.unsplash.com/photo-1502134249126-9f3755a50d78?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
      );
      Graph.renderer().setClearColor(new THREE.Color("black"));
      backgroundTexture.minFilter = THREE.LinearFilter;
      Graph.scene().background = backgroundTexture;
    </script>
  </body>
</html>
